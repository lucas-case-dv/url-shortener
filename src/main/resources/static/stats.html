<!-- stats.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Short URL Stats</title>
  <style>
      body {
          font-family: Arial, sans-serif;
          margin: 20px;
          background-color: #f4f4f9;
      }
      .container {
          max-width: 800px;
          margin: auto;
          overflow-x: hidden;
      }
      table {
          width: 100%;
          border-collapse: collapse;
      }
      th, td {
          padding: 12px;
          text-align: left;
          border-bottom: 1px solid #ddd;
      }
      th {
          background-color: #f2f2f2;
          font-weight: bold;
      }

      .stats-header {
          margin-bottom: 20px;
      }
  </style>
</head>
<body>
<div class="container">
  <h1>Short URL Stats</h1>
  <section class="stats-header">
    <p>Total Clicks: <span id="total-clicks">0</span></p>
  </section>
  <table id="stats-table">
    <thead>
    <tr>
      <th>Browser</th>
      <th>OS</th>
      <th>Referer</th>
      <th>Timestamp</th>
    </tr>
    </thead>
    <tbody>

    </tbody>
  </table>
</div>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const shortCode = window.location.pathname.split('/')[1];

        fetch(`/api/${shortCode}/stats`, {
            method: 'GET',
            headers: {
                'Accept': 'application/json'
            }
        })
            .then(response => {
                if (response.status === 204) {
                    console.warn('No clicks registered.');
                    return [];
                }
                if (!response.ok) throw new Error('Error when fetching data');
                return response.json();
            })
            .then(data => {
                const counter = document.getElementById('total-clicks');
                if (counter) counter.innerText = data.length;

                const tableBody = document.querySelector('#stats-table tbody');
                if (!tableBody) return;

                tableBody.innerHTML = '';

                data.forEach(stat => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                <td>${stat.userBrowser || 'N/A'}</td>
                <td>${stat.userOS || 'N/A'}</td>
                <td>${stat.referer || 'Direct'}</td>
                <td>${stat.clickedAt}</td>
            `;
                    tableBody.appendChild(row);
                });
            })
            .catch(error => console.error('Request error:', error));
    });
</script>
</body>
</html>